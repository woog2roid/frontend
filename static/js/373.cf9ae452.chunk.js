"use strict";(self.webpackChunkplayground_front=self.webpackChunkplayground_front||[]).push([[373],{8373:function(n,e,t){t.r(e),t.d(e,{default:function(){return Zn}});var a,o=t(885),i=t(2791),r=t(6871),s=t(2317),c={},l=function(n){var e=i.useCallback((function(){c[n]&&(c[n].disconnect(),delete c[n])}),[n]);return"game"!==n&&"chat"!==n?[void 0,function(){}]:(c[n]||(c[n]=(0,s.io)("".concat("https://server.woog2roid.dev","/").concat(n),{transports:["websocket"]}),console.log("create socket",n,c[n])),[c[n],e])},d=t(2419),u=t(9766),h=t(2033),x=t(2546),m=function(){var n=(0,r.UO)().id,e=i.useCallback((function(){o((function(e){var t=(0,x.Uy)(e,(function(e){null===e||void 0===e||e.map((function(e){return n&&e.id===+n&&(e.unreads=0),e}))}));return t}),!1)}),[n]),t=(0,d.ZP)("/chat-room",u.Z,{onSuccess:function(){console.log("onSuccess \ud568\uc218 \uc815\uc0c1 \uc791\ub3d9 \uc911"),n&&e()}}),a=t.data,o=t.mutate;return{chatRoomsData:a,mutateChatRoomsData:o,postLastReadTimestamp:function(){void 0!==n&&h.Z.post("/chat-room/".concat(n,"/last-read")).then((function(){e()}))}}},f=t(168),p=t(9958),v=p.Z.div(a||(a=(0,f.Z)(["\n  display: flex;\n  justify-content: space-between;\n\n  height: 35px;\n  width: 100%;\n\n  & > .unreads {\n    background-color: \n  }\n"]))),g=t(1918),Z=t(184);function j(n){var e=n.data,t=(0,r.s0)();return(0,Z.jsxs)(v,{onClick:function(){t("/chat/".concat(e.id))},children:[(0,Z.jsx)("span",{children:e.title}),e.unreads>0?(0,Z.jsx)(g.Z,{label:e.unreads,color:"error",variant:"outlined"}):(0,Z.jsx)(Z.Fragment,{})]})}var b,w,k,y=t(9621),C=t(4181),D=t(2982),M=t(1345),S=t(4554),R=t(8029),T=t(7924),N=t(4852),O=t(9174),H=t(6151),P=t(493),Y={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,maxHeight:630,bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,p:2},z=(0,p.Z)(H.Z)(b||(b=(0,f.Z)(["\n  float: right;\n"]))),F=(0,p.Z)(P.Z)(w||(w=(0,f.Z)(["\n  max-height: 500px;\n  overflow-y: auto;\n"])));function A(n){var e,t=n.isOpen,a=n.handleClose,r=(0,d.ZP)("/friend",u.Z).data,s=(0,d.ZP)("/user/me",u.Z),c=s.data,l=(s.mutate,m()),x=(l.chatRoomsData,l.mutateChatRoomsData),f=(l.postLastReadTimestamp,i.useState([])),p=(0,o.Z)(f,2),v=p[0],g=p[1],j=i.useCallback((function(n){if(n.preventDefault(),0===v.length)return alert("\ucc44\ud305\ubc29\uba64\ubc84\ub97c \uccb4\ud06c\ud574\uc8fc\uc138\uc694.");if(1===v.length)return alert("\uadf8\ub8f9\ucc44\ud305\ubc29 \ub9cc\ub4e4\uae30 \uc785\ub2c8\ub2e4. \uc77c\ub300\uc77c \ucc44\ud305\uc740 \uc790\ub3d9\uc0dd\uc131 \ub41c \ucc44\ud305\ubc29\uc744 \uc774\uc6a9\ud574\uc8fc\uc138\uc694.");if(a(),void 0!==c){var e=(0,D.Z)(v);e.push(c.id);var t=n.target.chatRoomTitle.value;console.log("\ucc44\ud305\ubc29 \uc720\uc800\ub4e4",e,"\ucc44\ud305\ubc29 \uc774\ub984",n.target.chatRoomTitle.value),h.Z.post("/chat-room?dm=false",{members:e,title:t}).then((function(e){x(),n.target.chatRoomTitle.value="",g([])}))}}),[v]);return(0,Z.jsx)(M.Z,{open:t,onClose:a,children:(0,Z.jsxs)(S.Z,{component:"form",sx:Y,onSubmit:j,children:[(0,Z.jsx)(R.Z,{name:"chatRoomTitle",placeholder:"\ucc44\ud305\ubc29 \uc774\ub984",size:"small",fullWidth:!0,required:!0}),(0,Z.jsx)(T.Z,{sx:{mt:1,mb:1}}),(0,Z.jsx)(F,{children:null===r||void 0===r||null===(e=r.friends)||void 0===e?void 0:e.map((function(n){return(0,Z.jsx)(N.ZP,{secondaryAction:(0,Z.jsx)(O.Z,{edge:"end",onChange:(e=n.following.id,function(){var n=v.indexOf(e),t=(0,D.Z)(v);-1===n?t.push(e):t.splice(n,1),g(t)}),checked:-1!==v.indexOf(n.following.id)}),children:(0,Z.jsxs)("span",{children:[n.following.nickname,"(",n.following.id,")\ub2d8"]})},+n.id);var e}))}),(0,Z.jsx)(T.Z,{sx:{mt:1,mb:1}}),(0,Z.jsx)(z,{type:"submit",variant:"contained",children:"\ucc44\ud305\ubc29 \ub9cc\ub4e4\uae30"})]})})}var E,U=p.Z.div(k||(k=(0,f.Z)(["\n  display: flex;\n  flex-direction: row-reverse;\n\n  padding: 5px;\n\n  & > .icons {\n    padding: 3px;\n  }\n"])));function L(){var n=i.useState(!1),e=(0,o.Z)(n,2),t=e[0],a=e[1];return(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsxs)(U,{children:[(0,Z.jsx)("span",{className:"icons",onClick:function(){console.log("\uc548 \uc77d\uc740 \ucc44\ud305 \ubaa8\ub450 \uc77d\uae30")},children:(0,Z.jsx)(y.Z,{})}),(0,Z.jsx)("span",{className:"icons",onClick:function(){a(!0)},children:(0,Z.jsx)(C.Z,{})})]}),(0,Z.jsx)(A,{isOpen:t,handleClose:function(){return a(!1)}})]})}function B(){var n=m(),e=n.chatRoomsData;n.mutateChatRoomsData,n.postLastReadTimestamp;return(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)(L,{}),(0,Z.jsx)(T.Z,{}),(0,Z.jsx)(P.Z,{sx:{padding:0,margin:0},children:null===e||void 0===e?void 0:e.map((function(n){return(0,Z.jsx)(N.ZP,{button:!0,children:(0,Z.jsx)(j,{data:n})},+n.id)}))})]})}var G,I,_=p.Z.div(E||(E=(0,f.Z)(["\n  display: flex;\n  height: 100%;\n\n  & > .chat-room-list {\n    width: 25%;\n    overflow-y: auto;\n    overflow-x: hidden;\n  }\n\n  & > .chat-box {\n    width: 75%;\n  }\n"]))),q=t(6713),W=t(9667),J=t(7892),K=t.n(J),Q=t(4440),V=p.Z.div(G||(G=(0,f.Z)(["\n  text-align: ",";\n  margin: 8px 0px;\n\n  & > .sender {\n    font-size: 13px;\n    margin: 2px;\n  }\n\n  & > .content {\n    display: flex;\n    flex-direction: ",";\n    align-items: center;\n\n    & > .message {\n      max-width: 800px;\n      word-break: break-all;\n      text-align: left;\n\n      border-radius: 6px;\n      padding: 3px 6px;\n      background-color: ",";\n\n      font-size: 16px;\n    }\n\n    & > .timestamp {\n      margin: 0px 5px;\n      font-size: 8px;\n    }\n  }\n"])),(function(n){return n.isMyMessage?"right":"left"}),(function(n){return n.isMyMessage?"row-reverse":"row"}),Q.Z.TransparentGray);function X(n){var e=n.data,t=n.isMyMessage,a=n.showsSender,o=e.message,i=e.createdAt,r=e.sender,s=(r.id,r.nickname);return(0,Z.jsxs)(V,{isMyMessage:t,children:[a?(0,Z.jsxs)("div",{className:"sender",children:[s,"\ub2d8"]}):(0,Z.jsx)(Z.Fragment,{}),(0,Z.jsxs)("div",{className:"content",children:[(0,Z.jsx)("span",{className:"message",children:o}),(0,Z.jsx)("span",{className:"timestamp",children:K()(i).format("h:mm A")})]})]})}var $=p.Z.div(I||(I=(0,f.Z)(["\n  text-align: center;\n  margin: 8px 0px;\n\n  & > .sender {\n    font-size: 13px;\n    margin: 2px;\n  }\n\n  & > .content {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n\n    & > .message {\n      max-width: 800px;\n      word-break: break-all;\n      text-align: left;\n\n      border-radius: 6px;\n      padding: 3px 6px;\n      background-color: ",";\n\n      font-size: 16px;\n    }\n  }\n"])),Q.Z.TransparentGray);function nn(n){var e=n.data,t=e.message;e.createdAt;return(0,Z.jsx)($,{children:(0,Z.jsx)("div",{className:"content",children:(0,Z.jsx)("span",{className:"message",children:t})})})}function en(n){var e=n.chatsByDate,t=(0,d.ZP)("/user/me",u.Z).data;return i.useEffect((function(){console.log("\ucc57\ub9ac\uc2a4\ud2b8 \ucef4\ud3ec\ub10c\ud2b8 \ud14c\uc2a4\ud2b8",Object.entries(e))})),(0,Z.jsx)(Z.Fragment,{children:Object.entries(e).map((function(n){var e=(0,o.Z)(n,2),a=e[0],i=e[1];return(0,Z.jsxs)("div",{children:[(0,Z.jsx)(T.Z,{children:(0,Z.jsx)(g.Z,{label:a})}),i.map((function(n,e){return n.system?(0,Z.jsx)(nn,{data:n},n.id):n.sender.id===(null===t||void 0===t?void 0:t.id)?(0,Z.jsx)(X,{data:n,showsSender:!1,isMyMessage:!0},n.id):0===e?(0,Z.jsx)(X,{data:n,showsSender:!0,isMyMessage:!1},n.id):(0,Z.jsx)(X,{data:n,showsSender:i[e-1].sender.id!==n.sender.id||K()(i[e-1].createdAt).format("YYYY-MM-DD HH:mm")!==K()(n.createdAt).format("YYYY-MM-DD HH:mm"),isMyMessage:!1},n.id)}))]},a)}))})}var tn={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,p:4};function an(n){var e=n.isOpen,t=n.handleClose,a=n.chatRoomMembers,o=(0,d.ZP)("/user/me",u.Z).data;return(0,Z.jsx)(M.Z,{open:e,onClose:t,children:(0,Z.jsx)(S.Z,{sx:tn,children:null===a||void 0===a?void 0:a.map((function(n){if(n.id!==(null===o||void 0===o?void 0:o.id))return(0,Z.jsxs)("div",{children:[n.nickname,"(",n.id,")\ub2d8"]},n.id)}))})})}var on,rn=t(6058),sn=p.Z.div(on||(on=(0,f.Z)(["\n  padding: 15px;\n  height: 25px;\n\n  display: flex;\n  align-items: center;\n\n  font-size: 18px;\n"])));function cn(){var n=(0,r.UO)().id,e=(0,d.ZP)("/chat-room",u.Z),t=e.data,a=(e.mutate,i.useState()),s=(0,o.Z)(a,2),c=s[0],l=s[1],x=i.useState(),m=(0,o.Z)(x,2),f=m[0],p=m[1],v=i.useState(!1),g=(0,o.Z)(v,2),j=g[0],b=g[1];return i.useEffect((function(){h.Z.get("/chat-room/".concat(n,"/member")).then((function(n){l(n.data),console.log(c)})).catch((function(n){console.log(n)})),function(){var e=null===t||void 0===t?void 0:t.find((function(e){if(void 0!==n)return e.id===+n}));p(e)}()}),[n]),(0,Z.jsxs)(sn,{children:[(0,Z.jsx)("span",{children:void 0!==f?f.title:" "}),(0,Z.jsx)(rn.Z,{onClick:function(){return b(!0)},fontSize:"small"}),(0,Z.jsx)(an,{isOpen:j,handleClose:function(){return b(!1)},chatRoomMembers:c})]})}var ln,dn,un=t(5861),hn=t(7757),xn=t.n(hn),mn=p.Z.form(ln||(ln=(0,f.Z)(["\n  width: 90%;\n  margin: 0 auto;\n  padding: 5px;\n  text-align: center;\n\n  border: 1px solid ",";\n  border-radius: 20px;\n\n  & > input {\n    background-color: transparent;\n\n    width: calc(90% - 30px);\n    height: 40px;\n\n    font-family: MinSans;\n    font-size: 15px;\n\n    border: none;\n    &: focus {\n      outline: none;\n    }\n  }\n"])),Q.Z.Gray);function fn(){var n=(0,r.UO)().id,e=i.useCallback(function(){var e=(0,un.Z)(xn().mark((function e(t){return xn().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),console.log(t.target.input.value),e.next=4,h.Z.post("/chat-room/".concat(n,"/chat"),{message:t.target.input.value}).catch((function(n){console.log(n)}));case 4:t.target.input.value="";case 5:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),[n]);return(0,Z.jsxs)(mn,{onSubmit:e,children:[(0,Z.jsx)("input",{name:"input",placeholder:"\uba54\uc138\uc9c0 \uc785\ub825..."}),(0,Z.jsx)(H.Z,{variant:"text",type:"submit",sx:{ml:"5px"},children:"\ubcf4\ub0b4\uae30"})]})}function pn(n){var e=n.data,t=n.onClick,a=n.onDelete,o=e.message,i=e.sender.nickname,r="".concat(i,"\ub2d8: ").concat(o);return(0,Z.jsx)(g.Z,{label:r,onClick:t,onDelete:a,sx:{width:"100%"}})}var vn=p.Z.div(dn||(dn=(0,f.Z)(["\n  height: 100%;\n\n  -ms-user-select: text;\n  -moz-user-select: text;\n  -khtml-user-select: text;\n  -webkit-user-select: text;\n  user-select: text;\n\n  & > .chat-room-info {\n    height: 55px;\n  }\n\n  & > .chat-room {\n    position: relative;\n\n    height: calc(100% - 10px - 55px - 70px);\n    padding: 5px 20px 5px 20px;\n\n    overflow-y: auto;\n    overflow-x: hidden;\n\n    & > .new-chat {\n      position: sticky;\n      bottom: 20px;\n    }\n  }\n\n  & > .message-input {\n    padding: 5px;\n    height: 60px;\n  }\n"])));function gn(){var n,e=(0,r.UO)().id,t=(0,d.ZP)("/user/me",u.Z).data,a=(0,W.ZP)((function(n){return"/chat-room/".concat(e,"/chat/?page=").concat(n+1)}),u.Z,{onSuccess:function(n){1===(null===n||void 0===n?void 0:n.length)&&setTimeout((function(){f()}),100)}}),s=a.data,c=a.mutate,h=a.setSize,m=i.useRef(null),f=i.useCallback((function(){m&&m.current&&(m.current.scrollTop=m.current.scrollHeight)}),[e]),p=i.useCallback((function(n){var e,t;if(0===n.target.scrollTop&&(s&&!(0===(null===s||void 0===s||null===(e=s[0])||void 0===e?void 0:e.length)||(null===s||void 0===s||null===(t=s[(null===s||void 0===s?void 0:s.length)-1])||void 0===t?void 0:t.length)<100))){var a=n.target.scrollHeight;h((function(n){return n+1})).then((function(){var e;m&&m.current&&(n.target.scrollTop=(null===m||void 0===m||null===(e=m.current)||void 0===e?void 0:e.scrollHeight)-a)}))}n.target.scrollTop>=n.target.scrollHeight-600&&b(void 0)}),[s]),v=i.useState(),g=(0,o.Z)(v,2),j=g[0],b=g[1],w=function(){b(void 0)};i.useEffect((function(){b(void 0)}),[e]);var k=l("chat"),y=(0,o.Z)(k,1)[0],C=i.useCallback((function(n){console.log("\uc6f9 \uc18c\ucf13 \uba54\uc138\uc9c0 \ub3c4\ucc29",n),c((function(e){var t=(0,x.ZP)(e,(function(e){null===e||void 0===e||e[0].unshift(n)}));return t}),!1).then((function(){m&&m.current&&(console.log(m.current.scrollTop,m.current.scrollHeight),m.current.scrollHeight<800||m.current.scrollTop>m.current.scrollHeight-800||n.sender.id===(null===t||void 0===t?void 0:t.id)?(f(),b(void 0)):b(n))}))}),[c]);i.useEffect((function(){return null===y||void 0===y||y.on("message",C),function(){null===y||void 0===y||y.off("message")}}),[y,c]);var M=void 0!==s?function(n){console.log("sortChatDataByDate \ud568\uc218 \uc2e4\ud589");var e={};return n.forEach((function(n){var t=K()(n.createdAt).format("YYYY-MM-DD");void 0===e[t]?e[t]=[n]:e[t].push(n)})),e}((n=[]).concat.apply(n,(0,D.Z)(s)).reverse()):void 0;return(0,Z.jsxs)(vn,{children:[(0,Z.jsx)("div",{className:"chat-room-info",children:(0,Z.jsx)(cn,{})}),(0,Z.jsx)(T.Z,{}),(0,Z.jsxs)("div",{className:"chat-room",ref:m,onScroll:p,children:[void 0!==M?(0,Z.jsx)(en,{chatsByDate:M}):(0,Z.jsx)(Z.Fragment,{}),void 0!==j?(0,Z.jsx)("div",{className:"new-chat",children:(0,Z.jsx)(pn,{data:j,onClick:function(){w(),f()},onDelete:w})}):(0,Z.jsx)(Z.Fragment,{})]}),(0,Z.jsx)("div",{className:"message-input",children:(0,Z.jsx)(fn,{})})]})}function Zn(){var n=(0,r.UO)().id,e=(0,d.ZP)("/user/me",u.Z).data,t=m(),a=(t.chatRoomsData,t.mutateChatRoomsData,t.postLastReadTimestamp),s=l("chat"),c=(0,o.Z)(s,2),h=c[0];c[1];return i.useEffect((function(){var t={userId:null===e||void 0===e?void 0:e.id,chatRoomId:n};return void 0!==n&&(null===h||void 0===h||h.emit("join",t),a()),function(){null===h||void 0===h||h.emit("leave",t),a()}}),[n]),(0,Z.jsx)(Z.Fragment,{children:(0,Z.jsx)(q.Z,{children:(0,Z.jsxs)(_,{children:[(0,Z.jsx)("div",{className:"chat-room-list",children:(0,Z.jsx)(B,{})}),(0,Z.jsx)(T.Z,{orientation:"vertical"}),(0,Z.jsx)("div",{className:"chat-box",children:void 0===n?(0,Z.jsx)(Z.Fragment,{}):(0,Z.jsx)(gn,{})})]})})})}}}]);
//# sourceMappingURL=373.cf9ae452.chunk.js.map