"use strict";(self.webpackChunkplayground_front=self.webpackChunkplayground_front||[]).push([[361],{1361:function(n,e,t){t.r(e),t.d(e,{default:function(){return gn}});var o,i=t(885),r=t(2791),a=t(6871),s=t(2317),c={},l=function(n){var e=r.useCallback((function(){c[n]&&(c[n].disconnect(),delete c[n])}),[n]);return"game"!==n&&"chat"!==n?[void 0,function(){}]:(c[n]||(c[n]=(0,s.io)("".concat("https://playground-backend-knyit.run.goorm.io","/").concat(n),{transports:["websocket"]}),console.log("create socket",n,c[n])),[c[n],e])},d=t(2419),u=t(9766),x=t(168),h=t(9958),f=h.Z.div(o||(o=(0,x.Z)(["\n  height: 35px;\n  width: 100%;\n"]))),p=t(184);function m(n){var e=n.data,t=(0,a.s0)();return(0,p.jsx)(f,{onClick:function(){t("/chat/".concat(e.id))},children:(0,p.jsx)("span",{children:e.title})})}var v,g,Z,j=t(9621),b=t(4181),k=t(2982),w=t(1345),y=t(4554),C=t(8029),M=t(7924),S=t(4852),D=t(9174),N=t(6151),P=t(493),T={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,maxHeight:630,bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,p:2},H=(0,h.Z)(N.Z)(v||(v=(0,x.Z)(["\n  float: right;\n"]))),O=(0,h.Z)(P.Z)(g||(g=(0,x.Z)(["\n  max-height: 500px;\n  overflow-y: auto;\n"]))),Y=t(2033);function z(n){var e,t=n.isOpen,o=n.handleClose,a=(0,d.ZP)("/friend",u.Z).data,s=(0,d.ZP)("/chat-room",u.Z),c=(s.data,s.mutate),l=(0,d.ZP)("/user/me",u.Z),x=l.data,h=(l.mutate,r.useState([])),f=(0,i.Z)(h,2),m=f[0],v=f[1],g=r.useCallback((function(n){if(n.preventDefault(),0===m.length)return alert("\ucc44\ud305\ubc29\uba64\ubc84\ub97c \uccb4\ud06c\ud574\uc8fc\uc138\uc694.");if(1===m.length)return alert("\uadf8\ub8f9\ucc44\ud305\ubc29 \ub9cc\ub4e4\uae30 \uc785\ub2c8\ub2e4. \uc77c\ub300\uc77c \ucc44\ud305\uc740 \uc790\ub3d9\uc0dd\uc131 \ub41c \ucc44\ud305\ubc29\uc744 \uc774\uc6a9\ud574\uc8fc\uc138\uc694.");if(o(),void 0!==x){var e=(0,k.Z)(m);e.push(x.id);var t=n.target.chatRoomTitle.value;console.log("\ucc44\ud305\ubc29 \uc720\uc800\ub4e4",e,"\ucc44\ud305\ubc29 \uc774\ub984",n.target.chatRoomTitle.value),Y.Z.post("/chat-room?dm=false",{members:e,title:t}).then((function(e){c(),n.target.chatRoomTitle.value="",v([])}))}}),[m]);return(0,p.jsx)(w.Z,{open:t,onClose:o,children:(0,p.jsxs)(y.Z,{component:"form",sx:T,onSubmit:g,children:[(0,p.jsx)(C.Z,{name:"chatRoomTitle",placeholder:"\ucc44\ud305\ubc29 \uc774\ub984",size:"small",fullWidth:!0,required:!0}),(0,p.jsx)(M.Z,{sx:{mt:1,mb:1}}),(0,p.jsx)(O,{children:null===a||void 0===a||null===(e=a.friends)||void 0===e?void 0:e.map((function(n){return(0,p.jsx)(S.ZP,{secondaryAction:(0,p.jsx)(D.Z,{edge:"end",onChange:(e=n.following.id,function(){var n=m.indexOf(e),t=(0,k.Z)(m);-1===n?t.push(e):t.splice(n,1),v(t)}),checked:-1!==m.indexOf(n.following.id)}),children:(0,p.jsxs)("span",{children:[n.following.nickname,"(",n.following.id,")\ub2d8"]})},+n.id);var e}))}),(0,p.jsx)(M.Z,{sx:{mt:1,mb:1}}),(0,p.jsx)(H,{type:"submit",variant:"contained",children:"\ucc44\ud305\ubc29 \ub9cc\ub4e4\uae30"})]})})}var F,R=h.Z.div(Z||(Z=(0,x.Z)(["\n  display: flex;\n  flex-direction: row-reverse;\n\n  padding: 5px;\n\n  & > .icons {\n    padding: 3px;\n  }\n"])));function A(){var n=r.useState(!1),e=(0,i.Z)(n,2),t=e[0],o=e[1];return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsxs)(R,{children:[(0,p.jsx)("span",{className:"icons",onClick:function(){console.log("\uc548 \uc77d\uc740 \ucc44\ud305 \ubaa8\ub450 \uc77d\uae30")},children:(0,p.jsx)(j.Z,{})}),(0,p.jsx)("span",{className:"icons",onClick:function(){o(!0)},children:(0,p.jsx)(b.Z,{})})]}),(0,p.jsx)(z,{isOpen:t,handleClose:function(){return o(!1)}})]})}function E(){var n=(0,d.ZP)("/chat-room",u.Z),e=n.data;n.mutate;return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(A,{}),(0,p.jsx)(M.Z,{}),(0,p.jsx)(P.Z,{sx:{padding:0,margin:0},children:null===e||void 0===e?void 0:e.map((function(n){return(0,p.jsx)(S.ZP,{button:!0,children:(0,p.jsx)(m,{data:n})},+n.id)}))})]})}var U,B,G=h.Z.div(F||(F=(0,x.Z)(["\n  display: flex;\n  height: 100%;\n\n  & > .chat-room-list {\n    width: 25%;\n    overflow-y: auto;\n    overflow-x: hidden;\n  }\n\n  & > .chat-box {\n    width: 75%;\n  }\n"]))),I=t(6713),_=t(9667),q=t(2546),W=t(7892),J=t.n(W),K=t(1918),L=t(4440),Q=h.Z.div(U||(U=(0,x.Z)(["\n  text-align: ",";\n  margin: 8px 0px;\n\n  & > .sender {\n    font-size: 13px;\n    margin: 2px;\n  }\n\n  & > .content {\n    display: flex;\n    flex-direction: ",";\n    align-items: center;\n\n    & > .message {\n      max-width: 800px;\n      word-break: break-all;\n      text-align: left;\n\n      border-radius: 6px;\n      padding: 3px 6px;\n      background-color: ",";\n\n      font-size: 16px;\n    }\n\n    & > .timestamp {\n      margin: 0px 5px;\n      font-size: 8px;\n    }\n  }\n"])),(function(n){return n.isMyMessage?"right":"left"}),(function(n){return n.isMyMessage?"row-reverse":"row"}),L.Z.TransparentGray);function V(n){var e=n.data,t=n.isMyMessage,o=n.showsSender,i=e.message,r=e.createdAt,a=e.sender,s=(a.id,a.nickname);return(0,p.jsxs)(Q,{isMyMessage:t,children:[o?(0,p.jsxs)("div",{className:"sender",children:[s,"\ub2d8"]}):(0,p.jsx)(p.Fragment,{}),(0,p.jsxs)("div",{className:"content",children:[(0,p.jsx)("span",{className:"message",children:i}),(0,p.jsx)("span",{className:"timestamp",children:J()(r).format("h:mm A")})]})]})}var X=h.Z.div(B||(B=(0,x.Z)(["\n  text-align: center;\n  margin: 8px 0px;\n\n  & > .sender {\n    font-size: 13px;\n    margin: 2px;\n  }\n\n  & > .content {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n\n    & > .message {\n      max-width: 800px;\n      word-break: break-all;\n      text-align: left;\n\n      border-radius: 6px;\n      padding: 3px 6px;\n      background-color: ",";\n\n      font-size: 16px;\n    }\n  }\n"])),L.Z.TransparentGray);function $(n){var e=n.data,t=e.message;e.createdAt;return(0,p.jsx)(X,{children:(0,p.jsx)("div",{className:"content",children:(0,p.jsx)("span",{className:"message",children:t})})})}function nn(n){var e=n.chatsByDate,t=(0,d.ZP)("/user/me",u.Z).data;return r.useEffect((function(){console.log("\ucc57\ub9ac\uc2a4\ud2b8 \ucef4\ud3ec\ub10c\ud2b8 \ud14c\uc2a4\ud2b8",Object.entries(e))})),(0,p.jsx)(p.Fragment,{children:Object.entries(e).map((function(n){var e=(0,i.Z)(n,2),o=e[0],r=e[1];return(0,p.jsxs)("div",{children:[(0,p.jsx)(M.Z,{children:(0,p.jsx)(K.Z,{label:o})}),r.map((function(n,e){return n.system?(0,p.jsx)($,{data:n}):n.sender.id===(null===t||void 0===t?void 0:t.id)?(0,p.jsx)(V,{data:n,showsSender:!1,isMyMessage:!0},n.id):0===e?(0,p.jsx)(V,{data:n,showsSender:!0,isMyMessage:!1},n.id):(0,p.jsx)(V,{data:n,showsSender:r[e-1].sender.id!==n.sender.id||J()(r[e-1].createdAt).format("YYYY-MM-DD HH:mm")!==J()(n.createdAt).format("YYYY-MM-DD HH:mm"),isMyMessage:!1},n.id)}))]},o)}))})}var en={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:400,bgcolor:"background.paper",border:"2px solid #000",boxShadow:24,p:4};function tn(n){var e=n.isOpen,t=n.handleClose,o=n.chatRoomMembers,i=(0,d.ZP)("/user/me",u.Z).data;return(0,p.jsx)(w.Z,{open:e,onClose:t,children:(0,p.jsx)(y.Z,{sx:en,children:null===o||void 0===o?void 0:o.map((function(n){if(n.id!==(null===i||void 0===i?void 0:i.id))return(0,p.jsxs)("div",{children:[n.nickname,"(",n.id,")\ub2d8"]},n.id)}))})})}var on,rn=t(6058),an=h.Z.div(on||(on=(0,x.Z)(["\n  padding: 15px;\n  height: 25px;\n\n  display: flex;\n  align-items: center;\n\n  font-size: 18px;\n"])));function sn(){var n=(0,a.UO)().id,e=(0,d.ZP)("/chat-room",u.Z),t=e.data,o=(e.mutate,r.useState()),s=(0,i.Z)(o,2),c=s[0],l=s[1],x=r.useState(),h=(0,i.Z)(x,2),f=h[0],m=h[1],v=r.useState(!1),g=(0,i.Z)(v,2),Z=g[0],j=g[1];return r.useEffect((function(){Y.Z.get("/chat-room/".concat(n,"/member")).then((function(n){l(n.data),console.log(c)})).catch((function(n){console.log(n)})),function(){var e=null===t||void 0===t?void 0:t.find((function(e){if(void 0!==n)return e.id===+n}));m(e)}()}),[n]),(0,p.jsxs)(an,{children:[(0,p.jsx)("span",{children:void 0!==f?f.title:" "}),(0,p.jsx)(rn.Z,{onClick:function(){return j(!0)},fontSize:"small"}),(0,p.jsx)(tn,{isOpen:Z,handleClose:function(){return j(!1)},chatRoomMembers:c})]})}var cn,ln,dn=t(5861),un=t(7757),xn=t.n(un),hn=h.Z.form(cn||(cn=(0,x.Z)(["\n  width: 90%;\n  margin: 0 auto;\n  padding: 5px;\n  text-align: center;\n\n  border: 1px solid ",";\n  border-radius: 20px;\n\n  & > input {\n    background-color: transparent;\n\n    width: calc(90% - 30px);\n    height: 40px;\n\n    font-family: MinSans;\n    font-size: 15px;\n\n    border: none;\n    &: focus {\n      outline: none;\n    }\n  }\n"])),L.Z.Gray);function fn(){var n=(0,a.UO)().id,e=r.useCallback(function(){var e=(0,dn.Z)(xn().mark((function e(t){return xn().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),console.log(t.target.input.value),e.next=4,Y.Z.post("/chat-room/".concat(n,"/chat"),{message:t.target.input.value}).catch((function(n){console.log(n)}));case 4:t.target.input.value="";case 5:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),[n]);return(0,p.jsxs)(hn,{onSubmit:e,children:[(0,p.jsx)("input",{name:"input",placeholder:"\uba54\uc138\uc9c0 \uc785\ub825..."}),(0,p.jsx)(N.Z,{variant:"text",type:"submit",sx:{ml:"5px"},children:"\ubcf4\ub0b4\uae30"})]})}function pn(n){var e=n.data,t=n.onClick,o=n.onDelete,i=e.message,r=e.sender.nickname,a="".concat(r,"\ub2d8: ").concat(i);return(0,p.jsx)(K.Z,{label:a,onClick:t,onDelete:o,sx:{width:"100%"}})}var mn=h.Z.div(ln||(ln=(0,x.Z)(["\n  height: 100%;\n\n  -ms-user-select: text;\n  -moz-user-select: text;\n  -khtml-user-select: text;\n  -webkit-user-select: text;\n  user-select: text;\n\n  & > .chat-room-info {\n    height: 55px;\n  }\n\n  & > .chat-room {\n    position: relative;\n\n    height: calc(100% - 10px - 55px - 70px);\n    padding: 5px 20px 5px 20px;\n\n    overflow-y: auto;\n    overflow-x: hidden;\n\n    & > .new-chat {\n      position: sticky;\n      bottom: 20px;\n    }\n  }\n\n  & > .message-input {\n    padding: 5px;\n    height: 60px;\n  }\n"])));function vn(){var n,e=(0,a.UO)().id,t=(0,d.ZP)("/user/me",u.Z).data,o=(0,_.ZP)((function(n){return"/chat-room/".concat(e,"/chat/?page=").concat(n+1)}),u.Z,{onSuccess:function(n){1===(null===n||void 0===n?void 0:n.length)&&setTimeout((function(){f()}),100)}}),s=o.data,c=o.mutate,x=o.setSize,h=r.useRef(null),f=r.useCallback((function(){h&&h.current&&(h.current.scrollTop=h.current.scrollHeight)}),[e]),m=r.useCallback((function(n){var e,t;if(0===n.target.scrollTop&&(s&&!(0===(null===s||void 0===s||null===(e=s[0])||void 0===e?void 0:e.length)||(null===s||void 0===s||null===(t=s[(null===s||void 0===s?void 0:s.length)-1])||void 0===t?void 0:t.length)<100))){var o=n.target.scrollHeight;x((function(n){return n+1})).then((function(){var e;h&&h.current&&(n.target.scrollTop=(null===h||void 0===h||null===(e=h.current)||void 0===e?void 0:e.scrollHeight)-o)}))}n.target.scrollTop>=n.target.scrollHeight-600&&j(void 0)}),[s]),v=r.useState(),g=(0,i.Z)(v,2),Z=g[0],j=g[1],b=function(){j(void 0)};r.useEffect((function(){j(void 0)}),[e]);var w=l("chat"),y=(0,i.Z)(w,1)[0],C=r.useCallback((function(n){console.log("\uc6f9 \uc18c\ucf13 \uba54\uc138\uc9c0 \ub3c4\ucc29",n),c((function(e){var t=(0,q.ZP)(e,(function(e){null===e||void 0===e||e[0].unshift(n)}));return t}),!1).then((function(){h&&h.current&&(console.log(h.current.scrollTop,h.current.scrollHeight),h.current.scrollHeight<800||h.current.scrollTop>h.current.scrollHeight-800||n.sender.id===(null===t||void 0===t?void 0:t.id)?(f(),j(void 0)):j(n))}))}),[c]);r.useEffect((function(){return null===y||void 0===y||y.on("message",C),function(){null===y||void 0===y||y.off("message")}}),[y,c]);var S=void 0!==s?function(n){console.log("sortChatDataByDate \ud568\uc218 \uc2e4\ud589");var e={};return n.forEach((function(n){var t=J()(n.createdAt).format("YYYY-MM-DD");void 0===e[t]?e[t]=[n]:e[t].push(n)})),e}((n=[]).concat.apply(n,(0,k.Z)(s)).reverse()):void 0;return(0,p.jsxs)(mn,{children:[(0,p.jsx)("div",{className:"chat-room-info",children:(0,p.jsx)(sn,{})}),(0,p.jsx)(M.Z,{}),(0,p.jsxs)("div",{className:"chat-room",ref:h,onScroll:m,children:[void 0!==S?(0,p.jsx)(nn,{chatsByDate:S}):(0,p.jsx)(p.Fragment,{}),void 0!==Z?(0,p.jsx)("div",{className:"new-chat",children:(0,p.jsx)(pn,{data:Z,onClick:function(){b(),f()},onDelete:b})}):(0,p.jsx)(p.Fragment,{})]}),(0,p.jsx)("div",{className:"message-input",children:(0,p.jsx)(fn,{})})]})}function gn(){var n=(0,a.UO)().id,e=(0,d.ZP)("/user/me",u.Z).data,t=l("chat"),o=(0,i.Z)(t,2),s=o[0];o[1];return r.useEffect((function(){var t={userId:null===e||void 0===e?void 0:e.id,chatRoomId:n};return void 0!==n&&(console.log("\ucc44\ud305\ubc29 \uc785\uc7a5",t),null===s||void 0===s||s.emit("join",t)),function(){console.log("\ucc44\ud305\ubc29 \ub098\uac00\uae30",t),null===s||void 0===s||s.emit("leave",t)}}),[n]),(0,p.jsx)(p.Fragment,{children:(0,p.jsx)(I.Z,{children:(0,p.jsxs)(G,{children:[(0,p.jsx)("div",{className:"chat-room-list",children:(0,p.jsx)(E,{})}),(0,p.jsx)(M.Z,{orientation:"vertical"}),(0,p.jsx)("div",{className:"chat-box",children:void 0===n?(0,p.jsx)(p.Fragment,{}):(0,p.jsx)(vn,{})})]})})})}}}]);
//# sourceMappingURL=361.5b534e48.chunk.js.map